<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Tic-Tac-Toe</title>
<style>
body{margin:0;font-family:sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;min-height:100vh;background:#f0f0f0}
#startScreen{display:flex;width:100%;height:100vh}
#startScreen button{flex:1;font-size:2em;border:none;cursor:pointer;transition:0.2s;border-radius:0}
#normalBtn{background:#aaa}
#ultimateBtn{background:#f55}
#ultimateBtn:hover{animation:wiggle 0.2s infinite;background:red}
@keyframes wiggle{0%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}100%{transform:rotate(-2deg)}}
#gameScreen{display:none;flex-direction:column;align-items:center;margin-top:20px}
#gameContainer{display:grid;gap:10px;margin-top:20px}
.cell{background:#eee;border-radius:10px;display:flex;justify-content:center;align-items:center;font-size:36px;cursor:pointer;position:relative;transition:0.1s}
.cell.invalid{animation:shake 0.3s}
@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-5px)}50%{transform:translateX(5px)}75%{transform:translateX(-5px)}100%{transform:translateX(0)}}
.mini-board{display:grid;grid-template-columns:repeat(3,80px);grid-template-rows:repeat(3,80px);gap:3px;border:2px solid #999;border-radius:12px;background:#ddd;position:relative}
.win-line{position:absolute;background:limegreen;height:6px;width:0;border-radius:3px;top:0;left:0;transform-origin:center;transition:all 0.5s ease}
</style>
</head>
<body>
<div id="startScreen">
  <button id="normalBtn">Normal Mode</button>
  <button id="ultimateBtn">ULTIMATE TICTACTOE</button>
</div>
<div id="gameScreen">
  <h2 id="turnText"></h2>
  <div id="gameContainer"></div>
</div>
<script>
const startScreen=document.getElementById("startScreen");
const gameScreen=document.getElementById("gameScreen");
const container=document.getElementById("gameContainer");
const turnText=document.getElementById("turnText");
document.getElementById("normalBtn").addEventListener("click",()=>{startScreen.style.display="none";gameScreen.style.display="flex";container.innerHTML="";turnText.innerText="X's Turn";normalMode()});
document.getElementById("ultimateBtn").addEventListener("click",()=>{startScreen.style.display="none";gameScreen.style.display="flex";container.innerHTML="";turnText.innerText="X's Turn";ultimateMode()});
function normalMode(){
let board=Array(9).fill("");let turn="X";
container.style.gridTemplateColumns="repeat(3,100px)";container.style.gridTemplateRows="repeat(3,100px)";
for(let i=0;i<9;i++){const cell=document.createElement("div");cell.className="cell";cell.addEventListener("click",()=>{if(board[i]){flash(cell);return}board[i]=turn;cell.innerText=turn;if(checkWin(board)){alert(turn+" wins!");return}else{turn=turn==="X"?"O":"X";turnText.innerText=turn+"'s Turn"}});container.appendChild(cell)}
function flash(c){c.classList.add("invalid");setTimeout(()=>c.classList.remove("invalid"),300)}
function checkWin(b){const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];return wins.some(line=>line.every(idx=>b[idx]===b[line[0]] && b[idx]))}
}
function ultimateMode(){
let turn="X";let bigBoard=Array(9).fill(null).map(()=>Array(9).fill(""));let miniWins=Array(9).fill("");let nextMini=-1;
function createMiniBoard(index){const mini=document.createElement("div");mini.className="mini-board";mini.dataset.index=index;for(let i=0;i<9;i++){const cell=document.createElement("div");cell.className="cell";cell.addEventListener("click",()=>makeMove(index,i,cell));mini.appendChild(cell)}container.appendChild(mini)}
for(let i=0;i<9;i++) createMiniBoard(i);highlightActive();
function makeMove(miniIndex,cellIndex,cell){if(nextMini!==-1&&miniIndex!==nextMini){flash(cell);return}if(bigBoard[miniIndex][cellIndex]){flash(cell);return}if(miniWins[miniIndex]){flash(cell);return}bigBoard[miniIndex][cellIndex]=turn;cell.innerText=turn;if(checkWin(bigBoard[miniIndex])){miniWins[miniIndex]=turn;const miniDiv=container.children[miniIndex];miniDiv.style.background=turn==="X"?"#aaf":"#faa"}if(checkWin(miniWins)){alert(turn+" wins Ultimate Tic-Tac-Toe!");location.reload();return}nextMini=miniWins[cellIndex]?-1:cellIndex;highlightActive();turn=turn==="X"?"O":"X";turnText.innerText="Turn: "+turn}
function flash(cell){cell.classList.add("invalid");setTimeout(()=>cell.classList.remove("invalid"),300)}
function checkWin(b){const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];return wins.some(line=>line.every(idx=>b[idx]===b[line[0]] && b[idx]))}
function highlightActive(){container.querySelectorAll(".mini-board").forEach((mini,idx)=>{mini.style.boxShadow=(nextMini===-1||nextMini==idx)?"0 0 15px limegreen inset":"none"})}
}
</script>
</body>
</html>
