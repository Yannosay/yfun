<html>
<head>
<meta charset="UTF-8">
<title>Draw Together Multiplayer</title>
<style>
body, html { margin:0; padding:0; height:100%; overflow:hidden; background:#fff; }
#toolbar {
    position:fixed; top:10px; left:50%; transform:translateX(-50%);
    background:#222; padding:8px 12px; border-radius:8px; z-index:1000;
    display:flex; gap:10px;
}
#toolbar button {
    background:#444; color:#fff; border:none; padding:6px 12px; cursor:pointer; border-radius:6px;
}
#toolbar button:hover { background:#666; }
canvas { display:block; position:absolute; top:0; left:0; }
</style>
</head>
<body>

<div id="toolbar">
<button id="pen">Pen</button>
<button id="eraser">Eraser</button>
<button id="clear">Clear</button>
</div>

<canvas id="canvas"></canvas>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ====== FIREBASE CONFIG ======
const firebaseConfig = {
  apiKey: "AIzaSyAIXlO32dXQaJSTJqnlLZ7ylapdfukuwCI",
  authDomain: "drawtogether-fe581.firebaseapp.com",
  projectId: "drawtogether-fe581",
  databaseURL: "https://drawtogether-fe581-default-rtdb.firebaseio.com",
  storageBucket: "drawtogether-fe581.firebasestorage.app",
  messagingSenderId: "388416050930",
  appId: "1:388416050930:web:3fdd00f84c07dc8be5226b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const strokesRef = db.ref("strokes");

// ====== CANVAS SETUP ======
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
let drawing=false, tool="pen", lastX=0, lastY=0;

function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// ====== TOOLBAR ======
document.getElementById("pen").onclick = ()=>tool="pen";
document.getElementById("eraser").onclick = ()=>tool="eraser";
document.getElementById("clear").onclick = ()=>{
    ctx.clearRect(0,0,canvas.width,canvas.height);
    strokesRef.remove(); // clears for everyone
};

// ====== DRAW FUNCTION ======
function drawLine(x1,y1,x2,y2,t){
    ctx.beginPath();
    ctx.moveTo(x1,y1);
    ctx.lineTo(x2,y2);
    ctx.lineWidth = (t==="pen") ? 2 : 20;
    ctx.strokeStyle = "#000";
    ctx.globalCompositeOperation = (t==="eraser") ? "destination-out" : "source-over";
    ctx.stroke();
    ctx.closePath();
}

// ====== SEND STROKE TO FIREBASE ======
function sendStroke(x1,y1,x2,y2,t){
    strokesRef.push({x1,y1,x2,y2,tool:t});
}

// ====== MOUSE EVENTS ======
canvas.addEventListener("mousedown", e=>{
    drawing=true;
    lastX=e.clientX;
    lastY=e.clientY;
});
canvas.addEventListener("mouseup", ()=>drawing=false);
canvas.addEventListener("mouseout", ()=>drawing=false);
canvas.addEventListener("mousemove", e=>{
    if(!drawing) return;
    drawLine(lastX,lastY,e.clientX,e.clientY,tool);
    sendStroke(lastX,lastY,e.clientX,e.clientY,tool);
    lastX=e.clientX; lastY=e.clientY;
});

// ====== TOUCH EVENTS ======
canvas.addEventListener("touchstart", e=>{
    drawing=true;
    lastX=e.touches[0].clientX;
    lastY=e.touches[0].clientY;
});
canvas.addEventListener("touchend", ()=>drawing=false);
canvas.addEventListener("touchmove", e=>{
    if(!drawing) return;
    drawLine(lastX,lastY,e.touches[0].clientX,e.touches[0].clientY,tool);
    sendStroke(lastX,lastY,e.touches[0].clientX,e.touches[0].clientY,tool);
    lastX=e.touches[0].clientX;
    lastY=e.touches[0].clientY;
    e.preventDefault();
});

// ====== LISTEN TO FIREBASE FOR MULTIPLAYER ======
strokesRef.on("child_added", snap=>{
    const s = snap.val();
    drawLine(s.x1,s.y1,s.x2,s.y2,s.tool);
});

// Clear canvas if strokes removed
strokesRef.on("child_removed", ()=>ctx.clearRect(0,0,canvas.width,canvas.height));
</script>

</body>
</html>
