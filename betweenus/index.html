<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Between Us - YannoFun</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
<style>
body{margin:0;overflow:hidden;background:#000;} 
input{outline:none;font-size:20px;text-align:center;position:absolute;z-index:1000;}
</style>
</head>
<body>
<div id="game"></div>
<script>
const FB=(()=>{
const firebaseConfig={apiKey:"AIzaSyC8NPujb__Y16DvkUeX5Nh7bCDVBoXPilY",authDomain:"between-us-2dbf3.firebaseapp.com",projectId:"between-us-2dbf3",storageBucket:"between-us-2dbf3.firebasestorage.app",messagingSenderId:"361123395508",appId:"1:361123395508:web:b141e442cf3ae196b824e1",measurementId:"G-F39ESJGWN8"};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();
let uid=null;
async function init(){if(auth.currentUser){uid=auth.currentUser.uid;return;}let user=await auth.signInAnonymously();uid=user.user.uid;}
init();
return {auth,db,get uid(){return uid}};
})();

const Net=(()=>{
let lobbyCode=null,lobbyRef=null;
async function createLobby(options){
try{
lobbyCode=Math.floor(1000+Math.random()*9000).toString();
lobbyRef=FB.db.collection('lobbies').doc(lobbyCode);
await lobbyRef.set({players:{},options:options,state:'waiting'});
await joinLobby(lobbyCode);
return lobbyCode;
}catch(e){console.error('Create Lobby Error:',e);throw e;}
}
async function joinLobby(code){
try{
lobbyRef=FB.db.collection('lobbies').doc(code);
let doc=await lobbyRef.get();
if(!doc.exists)throw new Error('Lobby not found');
let data=doc.data();
if(!data.players)data.players={};
let name='Anonymous';
let suffix=1;
while(Object.values(data.players).some(p=>p.name===name)){suffix++;name='Anonymous('+suffix+')';}
data.players[FB.uid]={name:name,color:0xffffff,x:400,y:300,alive:true};
await lobbyRef.update({players:data.players});
return true;
}catch(e){console.error('Join Lobby Error:',e);throw e;}
}
async function leaveLobby(){
if(!lobbyRef)return;
try{let doc=await lobbyRef.get();if(doc.exists){let data=doc.data();delete data.players[FB.uid];await lobbyRef.update(data);}}
catch(e){console.error('Leave Lobby Error:',e);}
lobbyCode=null;lobbyRef=null;
}
function getLobbyCode(){return lobbyCode;}
async function updatePlayer(data){if(!lobbyRef)return;
try{let doc=await lobbyRef.get();if(!doc.exists)return;let d=doc.data();if(!d.players)d.players={};d.players[FB.uid]={...(d.players[FB.uid]||{}),...data};await lobbyRef.update(d);}catch(e){console.error('Update Player Error:',e);}}
return {createLobby,joinLobby,leaveLobby,getLobbyCode,updatePlayer};
})();

const UI=(()=>{
let scene;
function init(g,s){scene=s;}
function makeStarfield(bgLayer){for(let i=0;i<120;i++){let s=scene.add.circle(Math.random()*scene.scale.width,Math.random()*scene.scale.height,Math.random()*2+1,0xffffff,Math.random()*0.7+0.3);s.speed=Math.random()*0.2+0.05;bgLayer.add(s);}}
function updateStarfield(bgLayer){bgLayer.getChildren().forEach(s=>{s.y+=s.speed;if(s.y>scene.scale.height){s.y=0;s.x=Math.random()*scene.scale.width;}});}
function makeButton(x,y,text,cb){let c=scene.add.container(x,y);let bg=scene.add.rectangle(0,0,260,70,0x1b1f2b).setStrokeStyle(3,0xffffff);let l=scene.add.text(0,0,text,{fontFamily:'Montserrat',fontSize:'26px',fontStyle:'800',color:'#ffffff'}).setOrigin(0.5);c.add(bg);c.add(l);bg.setInteractive({useHandCursor:true}).on('pointerdown',()=>cb()).on('pointerover',()=>bg.setFillStyle(0x2a3142)).on('pointerout',()=>bg.setFillStyle(0x1b1f2b));return c;}
function makeDOMInput(x,y,placeholder='CODE'){let el=scene.add.dom(x,y,'input','width:220px;height:48px;border-radius:12px;border:2px solid white;background:#0f1420;color:white;','');el.node.placeholder=placeholder;el.node.maxLength=4;el.node.style.zIndex=1000;el.node.style.position='absolute';return {el,get value(){return el.node.value.trim().toUpperCase();},destroy(){el.destroy();}};}
function showMessage(text,d=3000){let m=scene.add.text(scene.scale.width/2,scene.scale.height-80,text,{fontFamily:'Montserrat',fontSize:'22px',color:'#ffffff',backgroundColor:'#000000aa',padding:{x:14,y:8}}).setOrigin(0.5);scene.time.delayedCall(d,()=>m.destroy());}
return {init,makeStarfield,updateStarfield,makeButton,makeDOMInput,showMessage};
})();

const GameMain=(()=>{
let game;
class Boot extends Phaser.Scene{constructor(){super('boot');}create(){this.scene.start('menu');}}
class Menu extends Phaser.Scene{constructor(){super('menu');}create(){UI.init(this.game,this);this.bgLayer=this.add.layer();UI.makeStarfield(this.bgLayer);this.add.text(this.scale.width/2,120,'BETWEEN US',{fontFamily:'Montserrat',fontSize:'64px',fontStyle:'800',color:'#ffffff'}).setOrigin(0.5);UI.makeButton(this.scale.width/2,this.scale.height/2-60,'START',()=>this.scene.start('serverRoom'));UI.makeButton(this.scale.width/2,this.scale.height/2+40,'SETTINGS',()=>UI.showMessage('Soon'));UI.makeButton(this.scale.width/2,this.scale.height/2+140,'EXIT',()=>window.location.href='index.html');}update(){if(this.bgLayer)UI.updateStarfield(this.bgLayer);}}
class ServerRoom extends Phaser.Scene{constructor(){super('serverRoom');}create(){UI.init(this.game,this);this.bgLayer=this.add.layer();UI.makeStarfield(this.bgLayer);this.add.text(this.scale.width/2,80,'SERVER ROOM',{fontFamily:'Montserrat',fontSize:'46px',fontStyle:'800',color:'#ffffff'}).setOrigin(0.5);
this.codeInput=UI.makeDOMInput(this.scale.width/2,160,'ENTER CODE');
this.codeInput.el.node.style.zIndex=9999;
UI.makeButton(this.scale.width/2,240,'JOIN',async()=>{
let val=this.codeInput.value;if(!val)return UI.showMessage('Enter code');
try{await Net.joinLobby(val);UI.showMessage('Joined lobby '+val,2500);this.codeInput.destroy();this.scene.start('lobby');}catch(e){UI.showMessage('Join failed');console.error(e);}});
UI.makeButton(this.scale.width/2,340,'CREATE LOBBY',async()=>{
try{let code=await Net.createLobby({maxPlayers:10,minPlayers:3,autoStart:false});UI.showMessage('Lobby created: '+code,4000);this.codeInput.destroy();this.scene.start('lobby');}catch(e){UI.showMessage('Create failed');console.error(e);}});
UI.makeButton(this.scale.width/2,440,'BACK',()=>{this.codeInput.destroy();this.scene.start('menu');});}
update(){if(this.bgLayer)UI.updateStarfield(this.bgLayer);}}
class Lobby extends Phaser.Scene{constructor(){super('lobby');}create(){UI.init(this.game,this);this.add.text(this.scale.width/2,120,'Waiting in Lobby',{fontFamily:'Montserrat',fontSize:'28px',color:'#ffffff'}).setOrigin(0.5);
this.add.text(this.scale.width/2,60,'Code: '+Net.getLobbyCode(),{fontFamily:'Montserrat',fontSize:'26px',color:'#ffffff'}).setOrigin(0.5);
UI.makeButton(this.scale.width/2,this.scale.height-100,'LEAVE',async()=>{await Net.leaveLobby();this.scene.start('menu');});}}
class GameScene extends Phaser.Scene{constructor(){super('game');}create(){UI.init(this.game,this);this.bgLayer=this.add.layer();UI.makeStarfield(this.bgLayer);this.map=this.add.rectangle(2000,2000,4000,4000,0x0f1420);this.me=this.add.circle(400,300,22,0xffffff);this.cameras.main.startFollow(this.me,true,0.08,0.08);this.keys=this.input.keyboard.addKeys('W,A,S,D');}
update(){UI.updateStarfield(this.bgLayer);let speed=2.6;let vx=0,vy=0;if(this.keys.W.isDown)vy=-1;if(this.keys.S.isDown)vy=1;if(this.keys.A.isDown)vx=-1;if(this.keys.D.isDown)vx=1;this.me.x+=vx*speed;this.me.y+=vy*speed;}}
function start(){game=new Phaser.Game({type:Phaser.AUTO,parent:'game',width:window.innerWidth,height:window.innerHeight,backgroundColor:'#000000',physics:{default:'arcade'},scene:[Boot,Menu,ServerRoom,Lobby,GameScene],scale:{mode:Phaser.Scale.RESIZE}});}
return {start};
})();
window.addEventListener('load',()=>{GameMain.start();});
</script>
</body>
</html>
